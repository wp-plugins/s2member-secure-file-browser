/*!
 * tablesorter pager plugin
 * updated 1/4/2013
 */
(function($){$.extend({tablesorterPager:new function(){this.defaults={container:null,ajaxUrl:null,ajaxProcessing:function(ajax){return[0,[],null];},output:"{startRow} to {endRow} of {totalRows} rows",updateArrows:true,page:0,size:10,fixedHeight:false,removeRows:false,cssFirst:".first",cssPrev:".prev",cssNext:".next",cssLast:".last",cssGoto:".gotoPage",cssPageDisplay:".pagedisplay",cssPageSize:".pagesize",cssErrorRow:"tablesorter-errorRow",cssDisabled:"disabled",totalRows:0,totalPages:0,filteredRows:0,filteredPages:0};var $this=this,pagerArrows=function(c,disable){var a="addClass",r="removeClass",d=c.cssDisabled,dis=!!disable,tp=Math.min(c.totalPages,c.filteredPages);if(c.updateArrows){$(c.cssFirst+","+c.cssPrev,c.container)[(dis||c.page===0)?a:r](d);$(c.cssNext+","+c.cssLast,c.container)[(dis||c.page===tp-1)?a:r](d);}},updatePageDisplay=function(table,c){var i,p,s,t,out,f=$(table).hasClass("hasFilters")&&!c.ajaxUrl;c.filteredRows=(f)?table.config.$tbodies.children("tr:not(.filtered,.remove-me)").length:c.totalRows;c.filteredPages=(f)?Math.ceil(c.filteredRows/c.size):c.totalPages;if(Math.min(c.totalPages,c.filteredPages)>0){t=(c.size*c.page>c.filteredRows);c.startRow=(t)?1:(c.size*c.page)+1;c.page=(t)?0:c.page;c.endRow=Math.min(c.filteredRows,c.totalRows,c.size*(c.page+1));out=$(c.cssPageDisplay,c.container);s=c.output.replace(/\{(page|filteredRows|filteredPages|totalPages|startRow|endRow|totalRows)\}/gi,function(m){return{"{page}":c.page+1,"{filteredRows}":c.filteredRows,"{filteredPages}":c.filteredPages,"{totalPages}":c.totalPages,"{startRow}":c.startRow,"{endRow}":c.endRow,"{totalRows}":c.totalRows}[m];});if(out[0]){out[(out[0].tagName==="INPUT")?"val":"html"](s);if($(c.cssGoto,c.container).length){t="";p=Math.min(c.totalPages,c.filteredPages);for(i=1;i<=p;i++){t+="<option>"+i+"</option>";}$(c.cssGoto,c.container).html(t).val(c.page+1);}}}pagerArrows(c);if(c.initialized){$(table).trigger("pagerComplete",c);}},fixHeight=function(table,c){var d,h,$b=$(table.tBodies[0]);if(c.fixedHeight){$b.find("tr.pagerSavedHeightSpacer").remove();h=$.data(table,"pagerSavedHeight");if(h){d=h-$b.height();if(d>5&&$.data(table,"pagerLastSize")===c.size&&$b.children("tr:visible").length<c.size){$b.append('<tr class="pagerSavedHeightSpacer '+table.config.selectorRemove.replace(".","")+'" style="height:'+d+'px;"></tr>');}}}},changeHeight=function(table,c){var $b=$(table.tBodies[0]);$b.find("tr.pagerSavedHeightSpacer").remove();$.data(table,"pagerSavedHeight",$b.height());fixHeight(table,c);$.data(table,"pagerLastSize",c.size);},hideRows=function(table,c){if(!c.ajaxUrl){var i,rows=$(table.tBodies).children("tr:not(."+table.config.cssChildRow+")"),l=rows.length,s=(c.page*c.size),e=s+c.size,j=0;for(i=0;i<l;i++){if(!/filtered/.test(rows[i].className)){rows[i].style.display=(j>=s&&j<e)?"":"none";j++;}}}},hideRowsSetup=function(table,c){c.size=parseInt($(c.cssPageSize,c.container).find("option[selected]").val(),10)||c.size;$.data(table,"pagerLastSize",c.size);pagerArrows(c);if(!c.removeRows){hideRows(table,c);$(table).bind("sortEnd.pager filterEnd.pager",function(){hideRows(table,c);});}},renderAjax=function(data,table,c,exception){if(typeof(c.ajaxProcessing)==="function"){var i,j,hsh,$f,$sh,$t=$(table),tc=table.config,$b=c.$tbodies,hl=$t.find("thead th").length,tds="",err='<tr class="'+c.cssErrorRow+" "+tc.selectorRemove.replace(".","")+'"><td style="text-align: center;" colspan="'+hl+'">'+(exception?exception.message+" ("+exception.name+")":"No rows found")+"</td></tr>",result=c.ajaxProcessing(data)||[0,[]],d=result[1]||[],l=d.length,th=result[2];if(l>0){for(i=0;i<l;i++){tds+="<tr>";for(j=0;j<d[i].length;j++){tds+="<td>"+d[i][j]+"</td>";}tds+="</tr>";}}if(th&&th.length===hl){hsh=$t.hasClass("hasStickyHeaders");$sh=$t.find("."+((tc.widgetOptions&&tc.widgetOptions.stickyHeaders)||"tablesorter-stickyheader"));$f=$t.find("tfoot tr:first").children();$t.find("th."+tc.cssHeader).each(function(j){var $t=$(this),icn;if($t.find("."+tc.cssIcon).length){icn=$t.find("."+tc.cssIcon).clone(true);$t.find(".tablesorter-header-inner").html(th[j]).append(icn);if(hsh&&$sh.length){icn=$sh.find("th").eq(j).find("."+tc.cssIcon).clone(true);$sh.find("th").eq(j).find(".tablesorter-header-inner").html(th[j]).append(icn);}}else{$t.find(".tablesorter-header-inner").html(th[j]);$sh.find("th").eq(j).find(".tablesorter-header-inner").html(th[j]);}$f.eq(j).html(th[j]);});}$t.find("thead tr."+c.cssErrorRow).remove();if(exception){$t.find("thead").append(err);}else{$b.html(tds);}if(tc.showProcessing){$.tablesorter.isProcessing(table);}$t.trigger("update");c.totalRows=result[0]||0;c.totalPages=Math.ceil(c.totalRows/c.size);updatePageDisplay(table,c);fixHeight(table,c);if(c.initialized){$t.trigger("pagerChange",c);}}if(!c.initialized){c.initialized=true;$(table).trigger("pagerInitialized",c);}},getAjax=function(table,c){var url=getAjaxUrl(table,c),tc=table.config;if(url!==""){if(tc.showProcessing){$.tablesorter.isProcessing(table,true);}$(document).bind("ajaxError.pager",function(e,xhr,settings,exception){if(settings.url===url){renderAjax(null,table,c,exception);$(document).unbind("ajaxError.pager");}});$.getJSON(url,function(data){renderAjax(data,table,c);$(document).unbind("ajaxError.pager");});}},getAjaxUrl=function(table,c){var url=(c.ajaxUrl)?c.ajaxUrl.replace(/\{page\}/g,c.page).replace(/\{size\}/g,c.size):"",sl=table.config.sortList,fl=c.currentFilters||[],sortCol=url.match(/\{sortList[\s+]?:[\s+]?([^}]*)\}/),filterCol=url.match(/\{filterList[\s+]?:[\s+]?([^}]*)\}/),arry=[];if(sortCol){sortCol=sortCol[1];$.each(sl,function(i,v){arry.push(sortCol+"["+v[0]+"]="+v[1]);});url=url.replace(/\{sortList[\s+]?:[\s+]?([^\}]*)\}/g,arry.length?arry.join("&"):sortCol);}if(filterCol){filterCol=filterCol[1];$.each(fl,function(i,v){if(v){arry.push(filterCol+"["+i+"]="+encodeURIComponent(v));}});url=url.replace(/\{filterList[\s+]?:[\s+]?([^\}]*)\}/g,arry.length?arry.join("&"):filterCol);}return url;},renderTable=function(table,rows,c){c.isDisabled=false;var i,j,o,f=document.createDocumentFragment(),l=rows.length,s=(c.page*c.size),e=(s+c.size);if(l<1){return;}if(c.initialized){$(table).trigger("pagerChange",c);}if(!c.removeRows){hideRows(table,c);}else{if(e>rows.length){e=rows.length;}$(table.tBodies[0]).addClass("tablesorter-hidden");$.tablesorter.clearTableBody(table);for(i=s;i<e;i++){o=rows[i];l=o.length;for(j=0;j<l;j++){f.appendChild(o[j]);}}table.tBodies[0].appendChild(f);$(table.tBodies[0]).removeClass("tablesorter-hidden");}if(c.page>=c.totalPages){moveToLastPage(table,c);}updatePageDisplay(table,c);if(!c.isDisabled){fixHeight(table,c);}$(table).trigger("applyWidgets");},showAllRows=function(table,c){if(c.ajax){pagerArrows(c,true);}else{c.isDisabled=true;$.data(table,"pagerLastPage",c.page);$.data(table,"pagerLastSize",c.size);c.page=0;c.size=c.totalRows;c.totalPages=1;$("tr.pagerSavedHeightSpacer",table.tBodies[0]).remove();renderTable(table,table.config.rowsCopy,c);}$(c.container).find(c.cssPageSize+","+c.cssGoto).each(function(){$(this).addClass(c.cssDisabled)[0].disabled=true;});},moveToPage=function(table,c){if(c.isDisabled){return;}var p=Math.min(c.totalPages,c.filteredPages);if(c.page<0||c.page>(p-1)){c.page=0;}if(c.ajax){getAjax(table,c);}else{if(!c.ajax){renderTable(table,table.config.rowsCopy,c);}}$.data(table,"pagerLastPage",c.page);$.data(table,"pagerUpdateTriggered",true);if(c.initialized){$(table).trigger("pageMoved",c);}},setPageSize=function(table,size,c){c.size=size;$.data(table,"pagerLastPage",c.page);$.data(table,"pagerLastSize",c.size);c.totalPages=Math.ceil(c.totalRows/c.size);moveToPage(table,c);},moveToFirstPage=function(table,c){c.page=0;moveToPage(table,c);},moveToLastPage=function(table,c){c.page=(Math.min(c.totalPages,c.filteredPages)-1);moveToPage(table,c);},moveToNextPage=function(table,c){c.page++;if(c.page>=(Math.min(c.totalPages,c.filteredPages)-1)){c.page=(Math.min(c.totalPages,c.filteredPages)-1);}moveToPage(table,c);},moveToPrevPage=function(table,c){c.page--;if(c.page<=0){c.page=0;}moveToPage(table,c);},destroyPager=function(table,c){showAllRows(table,c);$(c.container).hide();table.config.appender=null;$(table).unbind("destroy.pager sortEnd.pager filterEnd.pager enable.pager disable.pager");},enablePager=function(table,c,triggered){var p=$(c.cssPageSize,c.container).removeClass(c.cssDisabled).removeAttr("disabled");$(c.container).find(c.cssGoto).removeClass(c.cssDisabled).removeAttr("disabled");c.isDisabled=false;c.page=$.data(table,"pagerLastPage")||c.page||0;c.size=$.data(table,"pagerLastSize")||parseInt(p.find("option[selected]").val(),10)||c.size;p.val(c.size);c.totalPages=Math.ceil(Math.min(c.totalPages,c.filteredPages)/c.size);if(triggered){$(table).trigger("update");setPageSize(table,c.size,c);hideRowsSetup(table,c);fixHeight(table,c);}};$this.appender=function(table,rows){var c=table.config.pager;if(!c.ajax){table.config.rowsCopy=rows;c.totalRows=rows.length;c.size=$.data(table,"pagerLastSize")||c.size;c.totalPages=Math.ceil(c.totalRows/c.size);renderTable(table,rows,c);}};$this.construct=function(settings){return this.each(function(){if(!(this.config&&this.hasInitialized)){return;}var t,ctrls,fxn,config=this.config,c=config.pager=$.extend({},$.tablesorterPager.defaults,settings),table=this,tc=table.config,$t=$(table),pager=$(c.container).addClass("tablesorter-pager").show();config.appender=$this.appender;$t.unbind("filterStart.pager filterEnd.pager sortEnd.pager disable.pager enable.pager destroy.pager update.pager").bind("filterStart.pager",function(e,filters){$.data(table,"pagerUpdateTriggered",false);c.currentFilters=filters;}).bind("filterEnd.pager sortEnd.pager",function(e){if($.data(table,"pagerUpdateTriggered")){$.data(table,"pagerUpdateTriggered",false);return;}if(e.type==="filterEnd"){c.page=0;}updatePageDisplay(table,c);moveToPage(table,c);fixHeight(table,c);}).bind("disable.pager",function(){showAllRows(table,c);}).bind("enable.pager",function(){enablePager(table,c,true);}).bind("destroy.pager",function(){destroyPager(table,c);}).bind("update.pager",function(){hideRows(table,c);});ctrls=[c.cssFirst,c.cssPrev,c.cssNext,c.cssLast];fxn=[moveToFirstPage,moveToPrevPage,moveToNextPage,moveToLastPage];pager.find(ctrls.join(",")).unbind("click.pager").bind("click.pager",function(e){var i,$this=$(this),l=ctrls.length;if(!$this.hasClass(c.cssDisabled)){for(i=0;i<l;i++){if($this.is(ctrls[i])){fxn[i](table,c);break;}}}return false;});if(pager.find(c.cssGoto).length){pager.find(c.cssGoto).unbind("change").bind("change",function(){c.page=$(this).val()-1;moveToPage(table,c);});updatePageDisplay(table,c);}t=pager.find(c.cssPageSize);if(t.length){t.unbind("change.pager").bind("change.pager",function(){t.val($(this).val());if(!$(this).hasClass(c.cssDisabled)){setPageSize(table,parseInt($(this).val(),10),c);changeHeight(table,c);}return false;});}c.initialized=false;$t.trigger("pagerBeforeInitialized",c);enablePager(table,c,false);if(typeof(c.ajaxUrl)==="string"){c.ajax=true;tc.widgetOptions.filter_serversideFiltering=true;tc.serverSideSorting=true;moveToPage(table,c);}else{c.ajax=false;$(this).trigger("appendCache",true);hideRowsSetup(table,c);}changeHeight(table,c);if(!c.ajax){c.initialized=true;$(table).trigger("pagerInitialized",c);}});};}()});$.fn.extend({tablesorterPager:$.tablesorterPager.construct});})(jQuery);